import{j as y}from"./jsx-runtime.D_zvdyIk.js";import{r as t}from"./index.BJfUAbRs.js";import{M as T,b as W,u as L,P as b,o as A,h as D,L as H}from"./proxy.LfA21RH3.js";class K extends t.Component{getSnapshotBeforeUpdate(l){const e=this.props.childRef.current;if(e&&l.isPresent&&!this.props.isPresent){const c=e.offsetParent,m=W(c)&&c.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=m-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function U({children:f,isPresent:l,anchorX:e,root:c}){const m=t.useId(),n=t.useRef(null),p=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:x}=t.useContext(T);return t.useInsertionEffect(()=>{const{width:g,height:s,top:E,left:r,right:u}=p.current;if(l||!n.current||!g||!s)return;const a=e==="left"?`left: ${r}`:`right: ${u}`;n.current.dataset.motionPopId=m;const o=document.createElement("style");x&&(o.nonce=x);const d=c??document.head;return d.appendChild(o),o.sheet&&o.sheet.insertRule(`
          [data-motion-pop-id="${m}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${s}px !important;
            ${a}px !important;
            top: ${E}px !important;
          }
        `),()=>{d.removeChild(o),d.contains(o)&&d.removeChild(o)}},[l]),y.jsx(K,{isPresent:l,childRef:n,sizeRef:p,children:t.cloneElement(f,{ref:n})})}const B=({children:f,initial:l,isPresent:e,onExitComplete:c,custom:m,presenceAffectsLayout:n,mode:p,anchorX:x,root:g})=>{const s=L(F),E=t.useId();let r=!0,u=t.useMemo(()=>(r=!1,{id:E,initial:l,isPresent:e,custom:m,onExitComplete:a=>{s.set(a,!0);for(const o of s.values())if(!o)return;c&&c()},register:a=>(s.set(a,!1),()=>s.delete(a))}),[e,s,c]);return n&&r&&(u={...u}),t.useMemo(()=>{s.forEach((a,o)=>s.set(o,!1))},[e]),t.useEffect(()=>{!e&&!s.size&&c&&c()},[e]),p==="popLayout"&&(f=y.jsx(U,{isPresent:e,anchorX:x,root:g,children:f})),y.jsx(b.Provider,{value:u,children:f})};function F(){return new Map}const P=f=>f.key||"";function $(f){const l=[];return t.Children.forEach(f,e=>{t.isValidElement(e)&&l.push(e)}),l}const _=({children:f,custom:l,initial:e=!0,onExitComplete:c,presenceAffectsLayout:m=!0,mode:n="sync",propagate:p=!1,anchorX:x="left",root:g})=>{const[s,E]=A(p),r=t.useMemo(()=>$(f),[f]),u=p&&!s?[]:r.map(P),a=t.useRef(!0),o=t.useRef(r),d=L(()=>new Map),[z,I]=t.useState(r),[C,w]=t.useState(r);D(()=>{a.current=!1,o.current=r;for(let h=0;h<C.length;h++){const i=P(C[h]);u.includes(i)?d.delete(i):d.get(i)!==!0&&d.set(i,!1)}},[C,u.length,u.join("-")]);const M=[];if(r!==z){let h=[...r];for(let i=0;i<C.length;i++){const R=C[i],v=P(R);u.includes(v)||(h.splice(i,0,R),M.push(R))}return n==="wait"&&M.length&&(h=M),w($(h)),I(r),null}const{forceRender:k}=t.useContext(H);return y.jsx(y.Fragment,{children:C.map(h=>{const i=P(h),R=p&&!s?!1:r===C||u.includes(i),v=()=>{if(d.has(i))d.set(i,!0);else return;let j=!0;d.forEach(S=>{S||(j=!1)}),j&&(k?.(),w(o.current),p&&E?.(),c&&c())};return y.jsx(B,{isPresent:R,initial:!a.current||e?void 0:!1,custom:l,presenceAffectsLayout:m,mode:n,root:g,onExitComplete:R?void 0:v,anchorX:x,children:h},i)})})};export{_ as A};
